{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RXNM 1.0 Unified API Schema",
  "description": "Contract for RXNM interactions including Input Requests (stdin) and Output Responses (stdout).",
  "type": "object",
  "oneOf": [
    {
      "$ref": "#/definitions/InputRequest",
      "description": "Any valid input command object"
    },
    {
      "$ref": "#/definitions/OutputResponse",
      "description": "Any valid output response object"
    }
  ],
  "definitions": {
    "InputRequest": {
      "type": "object",
      "required": [
        "category"
      ],
      "properties": {
        "category": {
          "type": "string",
          "enum": [
            "wifi",
            "interface",
            "system",
            "bluetooth",
            "vpn",
            "profile",
            "bridge",
            "bond",
            "vlan",
            "vrf",
            "macvlan",
            "ipvlan",
            "veth",
            "tun",
            "tap",
            "config",
            "api"
          ]
        },
        "action": {
          "type": "string"
        },
        "api_version": {
          "type": "string",
          "default": "1.0"
        },
        "force": {
          "type": "boolean"
        },
        "json": {
          "type": "boolean",
          "const": true
        },
        "get": {
          "type": "string",
          "description": "Specific value to extract (dot notation supported). Equivalent to --get."
        },
        "format": {
          "type": "string",
          "enum": [
            "json",
            "human",
            "table",
            "simple"
          ]
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "category": {
                "const": "wifi"
              }
            }
          },
          "then": {
            "$ref": "#/definitions/WifiInput"
          }
        },
        {
          "if": {
            "properties": {
              "category": {
                "const": "interface"
              }
            }
          },
          "then": {
            "$ref": "#/definitions/InterfaceInput"
          }
        },
        {
          "if": {
            "properties": {
              "category": {
                "const": "bluetooth"
              }
            }
          },
          "then": {
            "$ref": "#/definitions/BluetoothInput"
          }
        },
        {
          "if": {
            "properties": {
              "category": {
                "const": "system"
              }
            }
          },
          "then": {
            "$ref": "#/definitions/SystemInput"
          }
        },
        {
          "if": {
            "properties": {
              "category": {
                "const": "vpn"
              }
            }
          },
          "then": {
            "$ref": "#/definitions/VpnInput"
          }
        },
        {
          "if": {
            "properties": {
              "category": {
                "enum": [
                  "bridge",
                  "bond",
                  "vlan",
                  "vrf",
                  "macvlan",
                  "ipvlan",
                  "veth",
                  "tun",
                  "tap"
                ]
              }
            }
          },
          "then": {
            "$ref": "#/definitions/VirtualInput"
          }
        },
        {
          "if": {
            "properties": {
              "category": {
                "const": "profile"
              }
            }
          },
          "then": {
            "$ref": "#/definitions/ProfileInput"
          }
        },
        {
          "if": {
            "properties": {
              "category": {
                "const": "api"
              }
            }
          },
          "then": {
            "$ref": "#/definitions/ApiInput"
          }
        }
      ]
    },
    "WifiInput": {
      "properties": {
        "action": {
          "enum": [
            "scan",
            "connect",
            "disconnect",
            "ap",
            "wps",
            "list",
            "networks",
            "forget",
            "country",
            "p2p",
            "dpp",
            "roaming"
          ]
        },
        "ssid": {
          "type": "string"
        },
        "password": {
          "type": "string"
        },
        "hidden": {
          "type": "boolean"
        },
        "interface": {
          "type": "string"
        },
        "mode": {
          "enum": [
            "ap",
            "adhoc"
          ]
        },
        "share": {
          "type": "boolean"
        },
        "ip": {
          "type": "string"
        },
        "ipv6_pd": {
          "enum": [
            "yes",
            "no"
          ]
        },
        "uri": {
          "type": "string"
        },
        "peer": {
          "type": "string"
        },
        "threshold": {
          "type": "integer",
          "description": "Signal threshold for roaming nudge"
        },
        "channel": {
          "type": "integer",
          "description": "WiFi channel for AP mode"
        },
        "subcommand": {
          "type": "string"
        }
      }
    },
    "InterfaceInput": {
      "properties": {
        "action": {
          "enum": [
            "show",
            "set",
            "enable",
            "disable",
            "list",
            "hotplug"
          ]
        },
        "target": {
          "type": "string"
        },
        "subcommand": {
          "enum": [
            "dhcp",
            "static",
            "hardware"
          ]
        },
        "ip": {
          "type": "string"
        },
        "gateway": {
          "type": "string"
        },
        "dns": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ]
        },
        "domains": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ]
        },
        "routes": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ]
        },
        "mtu": {
          "type": "integer"
        },
        "metric": {
          "type": "integer"
        },
        "mac": {
          "type": "string"
        },
        "ipv6_privacy": {
          "type": "string"
        },
        "dhcp_id": {
          "type": "string"
        },
        "speed": {
          "type": "string"
        },
        "duplex": {
          "type": "string"
        },
        "autoneg": {
          "type": "string"
        },
        "wol": {
          "type": "string"
        },
        "mac_policy": {
          "type": "string"
        },
        "name_policy": {
          "type": "string"
        }
      }
    },
    "BluetoothInput": {
      "properties": {
        "action": {
          "enum": [
            "scan",
            "pair",
            "unpair",
            "pan"
          ]
        },
        "mac": {
          "type": "string"
        },
        "subcommand": {
          "enum": [
            "enable",
            "disable"
          ]
        },
        "mode": {
          "enum": [
            "client",
            "host"
          ]
        },
        "share": {
          "type": "boolean"
        },
        "ip": {
          "type": "string"
        }
      }
    },
    "SystemInput": {
      "properties": {
        "action": {
          "enum": [
            "status",
            "check",
            "proxy",
            "reload",
            "setup",
            "start",
            "stop",
            "nullify"
          ]
        },
        "subcommand": {
          "type": "string"
        },
        "http": {
          "type": "string"
        },
        "https": {
          "type": "string"
        },
        "noproxy": {
          "type": "string"
        },
        "interface": {
          "type": "string"
        },
        "dry_run": {
          "type": "boolean"
        }
      }
    },
    "VpnInput": {
      "properties": {
        "action": {
          "enum": [
            "connect",
            "disconnect",
            "delete",
            "create"
          ]
        },
        "name": {
          "type": "string"
        },
        "private_key": {
          "type": "string"
        },
        "peer_key": {
          "type": "string"
        },
        "endpoint": {
          "type": "string"
        },
        "allowed_ips": {
          "type": "string"
        },
        "address": {
          "type": "string"
        },
        "user": {
          "type": "string"
        },
        "group": {
          "type": "string"
        }
      }
    },
    "VirtualInput": {
      "properties": {
        "action": {
          "enum": [
            "create",
            "delete",
            "add-member",
            "add-slave",
            "list"
          ]
        },
        "name": {
          "type": "string"
        },
        "parent": {
          "type": "string"
        },
        "id": {
          "type": "integer"
        },
        "mode": {
          "type": "string"
        },
        "table": {
          "type": "integer"
        },
        "peer": {
          "type": "string"
        },
        "bridge": {
          "type": "string"
        },
        "bond": {
          "type": "string"
        },
        "vrf": {
          "type": "string"
        },
        "stp": {
          "type": "boolean"
        }
      }
    },
    "ProfileInput": {
      "properties": {
        "action": {
          "enum": [
            "list",
            "save",
            "load",
            "delete",
            "export",
            "import"
          ]
        },
        "name": {
          "type": "string"
        },
        "interface": {
          "type": "string"
        },
        "file": {
          "type": "string"
        }
      }
    },
    "ApiInput": {
      "properties": {
        "action": {
          "enum": [
            "schema",
            "version"
          ]
        }
      }
    },
    "OutputResponse": {
      "type": "object",
      "required": [
        "success"
      ],
      "properties": {
        "success": {
          "type": "boolean",
          "description": "Global success indicator."
        },
        "error": {
          "type": "string",
          "description": "Error message if success is false."
        },
        "hint": {
          "type": "string",
          "description": "User-friendly suggestion for resolving the error."
        },
        "exit_code": {
          "type": "integer",
          "description": "Process exit code if success is false."
        },
        "agent_version": {
          "type": "string",
          "description": "Version of the native agent."
        },
        "api_version": {
          "type": "string",
          "description": "API Version (e.g., '1.0')."
        }
      },
      "oneOf": [
        {
          "$ref": "#/definitions/SystemStatusResponse"
        },
        {
          "$ref": "#/definitions/WifiScanResponse"
        },
        {
          "$ref": "#/definitions/WifiKnownResponse"
        },
        {
          "$ref": "#/definitions/WifiP2PPeersResponse"
        },
        {
          "$ref": "#/definitions/WifiP2PStatusResponse"
        },
        {
          "$ref": "#/definitions/BluetoothScanResponse"
        },
        {
          "$ref": "#/definitions/ProfileListResponse"
        },
        {
          "$ref": "#/definitions/DiagnosticResponse"
        },
        {
          "$ref": "#/definitions/ActionResponse"
        }
      ]
    },
    "SystemStatusResponse": {
      "type": "object",
      "required": [
        "hostname",
        "interfaces"
      ],
      "properties": {
        "hostname": {
          "type": "string"
        },
        "global_proxy": {
          "$ref": "#/definitions/ProxyConfig"
        },
        "interfaces": {
          "type": "object",
          "description": "Map of interface names to details",
          "additionalProperties": {
            "$ref": "#/definitions/InterfaceDetails"
          }
        }
      }
    },
    "InterfaceDetails": {
      "type": "object",
      "required": [
        "name",
        "type",
        "state"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "ethernet",
            "wifi",
            "wifi_ap",
            "bridge",
            "bond",
            "vlan",
            "vrf",
            "macvlan",
            "ipvlan",
            "veth",
            "wireguard",
            "tun",
            "tap",
            "loopback",
            "gadget",
            "unknown",
            "virtual"
          ]
        },
        "state": {
          "type": "string",
          "description": "Operational state (routable, no-carrier, etc)"
        },
        "connected": {
          "type": "boolean"
        },
        "ip": {
          "type": [
            "string",
            "null"
          ],
          "description": "Primary IPv4 Address"
        },
        "ipv4": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of all IPv4 addresses"
        },
        "ipv6": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of all IPv6 addresses"
        },
        "gateway": {
          "type": [
            "string",
            "null"
          ]
        },
        "metric": {
          "type": "integer"
        },
        "mac": {
          "type": "string"
        },
        "mtu": {
          "type": "integer"
        },
        "speed": {
          "type": "integer",
          "description": "Link speed in Mbps"
        },
        "vendor": {
          "type": "string",
          "description": "Hardware vendor from udev"
        },
        "model": {
          "type": "string",
          "description": "Hardware model from udev"
        },
        "driver": {
          "type": "string",
          "description": "Kernel driver in use"
        },
        "bus_info": {
          "type": "string",
          "description": "Bus location (e.g. usb-0:1)"
        },
        "gwmac": {
          "type": "string",
          "description": "MAC address of the gateway (ARP)"
        },
        "stats": {
          "type": "object",
          "properties": {
            "rx_bytes": {
              "type": "integer"
            },
            "tx_bytes": {
              "type": "integer"
            }
          }
        },
        "wifi": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/definitions/WifiStatusDetails"
            }
          ]
        },
        "proxy": {
          "$ref": "#/definitions/ProxyConfig"
        },
        "members": {
          "type": [
            "string",
            "null"
          ],
          "description": "Comma-separated list of bridge members"
        },
        "routes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "dst": {
                "type": "string",
                "description": "Destination subnet"
              },
              "gw": {
                "type": "string"
              },
              "metric": {
                "type": "integer"
              }
            }
          }
        }
      }
    },
    "WifiStatusDetails": {
      "type": "object",
      "properties": {
        "ssid": {
          "type": [
            "string",
            "null"
          ]
        },
        "rssi": {
          "type": "integer",
          "description": "Signal strength in dBm"
        },
        "frequency": {
          "type": "integer",
          "description": "Frequency in MHz"
        },
        "state": {
          "type": "string"
        },
        "bssid": {
          "type": [
            "string",
            "null"
          ],
          "description": "MAC address of the connected Access Point"
        }
      }
    },
    "WifiScanResponse": {
      "type": "object",
      "required": [
        "results"
      ],
      "properties": {
        "results": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "ssid",
              "security",
              "strength_pct"
            ],
            "properties": {
              "ssid": {
                "type": "string"
              },
              "security": {
                "type": "string"
              },
              "connected": {
                "type": "boolean"
              },
              "known": {
                "type": "boolean"
              },
              "signal": {
                "type": "integer",
                "description": "Raw dBm"
              },
              "frequency": {
                "type": "integer",
                "description": "Frequency in MHz"
              },
              "strength_pct": {
                "type": "integer",
                "minimum": 0,
                "maximum": 100
              },
              "bssids": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "bssid": {
                      "type": "string"
                    },
                    "signal": {
                      "type": "integer"
                    },
                    "freq": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "WifiKnownResponse": {
      "type": "object",
      "required": [
        "networks"
      ],
      "properties": {
        "networks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "ssid"
            ],
            "properties": {
              "ssid": {
                "type": "string"
              },
              "security": {
                "type": "string"
              },
              "hidden": {
                "type": "boolean"
              },
              "last_connected": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "WifiP2PPeersResponse": {
      "type": "object",
      "required": [
        "peers"
      ],
      "properties": {
        "peers": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "name",
              "mac"
            ],
            "properties": {
              "name": {
                "type": "string"
              },
              "mac": {
                "type": "string"
              },
              "category": {
                "type": "string"
              },
              "connected": {
                "type": "boolean"
              }
            }
          }
        }
      }
    },
    "WifiP2PStatusResponse": {
      "type": "object",
      "required": [
        "peers",
        "interfaces",
        "is_go"
      ],
      "properties": {
        "is_go": {
          "type": "boolean",
          "description": "True if acting as Group Owner"
        },
        "peers": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "mac": {
                "type": "string"
              }
            }
          }
        },
        "interfaces": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/InterfaceDetails"
          }
        }
      }
    },
    "BluetoothScanResponse": {
      "type": "object",
      "required": [
        "devices"
      ],
      "properties": {
        "devices": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "mac",
              "name"
            ],
            "properties": {
              "mac": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "rssi": {
                "type": "integer"
              },
              "connected": {
                "type": "boolean"
              },
              "paired": {
                "type": "boolean"
              },
              "adapter": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "ProfileListResponse": {
      "type": "object",
      "required": [
        "profiles"
      ],
      "properties": {
        "scope": {
          "type": "string",
          "description": "'global' or interface name"
        },
        "profiles": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "DiagnosticResponse": {
      "type": "object",
      "properties": {
        "portal_detected": {
          "type": "boolean"
        },
        "ipv4": {
          "type": "boolean"
        },
        "ipv6": {
          "type": "boolean"
        },
        "connected": {
          "type": "boolean"
        },
        "target": {
          "type": "string",
          "description": "Redirect URL if portal detected"
        },
        "status": {
          "type": "string",
          "enum": [
            "online",
            "offline",
            "portal_locked"
          ]
        },
        "method": {
          "type": "string"
        },
        "auto_ack": {
          "type": "boolean",
          "description": "Auto-acknowledged portal"
        },
        "hijacked": {
          "type": "boolean",
          "description": "True if unusual portal behavior detected"
        },
        "http_code": {
          "type": "string"
        },
        "reason": {
          "type": "string"
        },
        "state": {
          "type": "string"
        },
        "note": {
          "type": "string"
        },
        "host": {
          "type": "string",
          "description": "Host reached in fallback mode"
        }
      }
    },
    "ActionResponse": {
      "type": "object",
      "description": "Flexible object for command acknowledgments",
      "properties": {
        "action": {
          "type": "string"
        },
        "status": {
          "type": "string"
        },
        "message": {
          "type": "string"
        },
        "note": {
          "type": "string"
        },
        "type": {
          "type": "string"
        },
        "mode": {
          "type": "string"
        },
        "iface": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "ssid": {
          "type": "string"
        },
        "mac": {
          "type": "string"
        },
        "ip": {
          "type": "string"
        },
        "gateway": {
          "type": "string"
        },
        "metric": {
          "type": "string"
        },
        "mtu": {
          "type": "string"
        },
        "ipv6_privacy": {
          "type": "string"
        },
        "ipv6_pd": {
          "type": "string"
        },
        "dhcp_id": {
          "type": "string"
        },
        "table": {
          "type": "integer"
        },
        "id": {
          "type": "integer"
        },
        "parent": {
          "type": "string"
        },
        "peer": {
          "type": "string"
        },
        "user": {
          "type": "string"
        },
        "group": {
          "type": "string"
        },
        "file": {
          "type": "string"
        },
        "profile": {
          "type": "string"
        },
        "scope": {
          "type": "string"
        },
        "connected": {
          "type": "boolean"
        },
        "open": {
          "type": "boolean"
        },
        "removed_configs": {
          "type": "integer"
        },
        "country": {
          "type": "string"
        },
        "method": {
          "type": "string"
        },
        "bridge": {
          "type": "string"
        },
        "bond": {
          "type": "string"
        },
        "vrf": {
          "type": "string"
        },
        "adapter": {
          "type": "string"
        },
        "paired": {
          "type": "boolean"
        }
      }
    },
    "ProxyConfig": {
      "oneOf": [
        {
          "type": "null"
        },
        {
          "type": "object",
          "properties": {
            "http": {
              "type": [
                "string",
                "null"
              ]
            },
            "https": {
              "type": [
                "string",
                "null"
              ]
            },
            "noproxy": {
              "type": [
                "string",
                "null"
              ]
            }
          }
        }
      ]
    }
  }
}
